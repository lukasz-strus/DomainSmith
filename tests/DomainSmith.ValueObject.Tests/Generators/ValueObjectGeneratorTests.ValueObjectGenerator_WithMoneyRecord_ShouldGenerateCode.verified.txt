// <auto-generated/>
using DomainSmith.ValueObject;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Threading;
using System.Threading.Tasks;
using System.Text.Json;

namespace TestNamespace;

partial record Money
{
    private Money(decimal amount, string currency)
    {
        Amount = amount;
		Currency = currency;
    }

    public static Money? Create(decimal amount, string currency)
    {
        OnCreating(ref amount, ref currency);
        
        var result = new Money(amount, currency);

        OnCreated(result);
        if (!TestNamespace.MoneyExtensions.CanCreate) return null;

        return result;
    }

    static partial void OnCreating(ref decimal amount, ref string currency);
    static partial void OnCreated(Money instance);

    private void AllowCreate()
    {
        TestNamespace.MoneyExtensions.CanCreate = true;
    }

    private void DisallowCreate()
    {
        TestNamespace.MoneyExtensions.CanCreate = false;
    }
}

public static partial class MoneyExtensions
{
    private static readonly System.Threading.AsyncLocal<bool?> _canCreate = new();

    public static bool CanCreate
    {
        get => _canCreate.Value ?? true;
        set => _canCreate.Value = value;
    }

    public static System.IDisposable UseCreate(bool value) => new Scope(_canCreate, value);

    private sealed class Scope : System.IDisposable
    {
        private readonly System.Threading.AsyncLocal<bool?> _local;
        private readonly bool? _previous;

        public Scope(System.Threading.AsyncLocal<bool?> local, bool value)
        {
            _local = local;
            _previous = local.Value;
            local.Value = value;
        }

        public void Dispose() => _local.Value = _previous;
    }
}